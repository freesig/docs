



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.2">
    
    
      
        <title>Simple Micro Blog tutorial - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#simple-micro-blog-tutorial" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="My Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              My Docs
            </span>
            <span class="md-header-nav__topic">
              
                Simple Micro Blog tutorial
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="My Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Some documentation" class="md-nav__link">
      Some documentation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../some/" title="Some" class="md-nav__link">
      Some
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Coreconcepts
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Coreconcepts
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../hello_gui/" title="Hello Test Tutorial" class="md-nav__link">
      Hello Test Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hello_holo/" title="Hello Holo Tutorial" class="md-nav__link">
      Hello Holo Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hello_me/" title="Hello me" class="md-nav__link">
      Hello me
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hello_test/" title="Hello Test Tutorial" class="md-nav__link">
      Hello Test Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../hello_world/" title="Hello World" class="md-nav__link">
      Hello World
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Simple Micro Blog tutorial
      </label>
    
    <a href="./" title="Simple Micro Blog tutorial" class="md-nav__link md-nav__link--active">
      Simple Micro Blog tutorial
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dna-hash" class="md-nav__link">
    DNA hash
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post" class="md-nav__link">
    Post
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entry" class="md-nav__link">
    Entry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-id" class="md-nav__link">
    Agent ID
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-post" class="md-nav__link">
    Create a post
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-do-i-have-to-specify-a-timestamp-and-author-arent-they-already-in-the-entrys-header" class="md-nav__link">
    Why do I have to specify a timestamp and author? Aren't they already in the entry's header?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieve-all-of-a-users-posts" class="md-nav__link">
    Retrieve all of a user's posts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-the-agents-id" class="md-nav__link">
    Get the agent's ID
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#show-the-agents-id-in-the-ui" class="md-nav__link">
    Show the agent's ID in the UI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-ui-to-allow-posts-to-be-created" class="md-nav__link">
    Update the UI to allow posts to be created
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-ui-to-retrieve-an-agents-posts" class="md-nav__link">
    Update the UI to retrieve an agent's posts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#call-create_post-from-javascript" class="md-nav__link">
    Call create_post from JavaScript
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-posts-list-dynamically" class="md-nav__link">
    Update the posts list dynamically
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-this-agents-id" class="md-nav__link">
    Get this agent's ID
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieve-an-agents-posts" class="md-nav__link">
    Retrieve an agent's posts
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dna-hash" class="md-nav__link">
    DNA hash
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post" class="md-nav__link">
    Post
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entry" class="md-nav__link">
    Entry
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#agent-id" class="md-nav__link">
    Agent ID
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-post" class="md-nav__link">
    Create a post
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-do-i-have-to-specify-a-timestamp-and-author-arent-they-already-in-the-entrys-header" class="md-nav__link">
    Why do I have to specify a timestamp and author? Aren't they already in the entry's header?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieve-all-of-a-users-posts" class="md-nav__link">
    Retrieve all of a user's posts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-the-agents-id" class="md-nav__link">
    Get the agent's ID
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#show-the-agents-id-in-the-ui" class="md-nav__link">
    Show the agent's ID in the UI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-ui-to-allow-posts-to-be-created" class="md-nav__link">
    Update the UI to allow posts to be created
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-ui-to-retrieve-an-agents-posts" class="md-nav__link">
    Update the UI to retrieve an agent's posts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#call-create_post-from-javascript" class="md-nav__link">
    Call create_post from JavaScript
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-posts-list-dynamically" class="md-nav__link">
    Update the posts list dynamically
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-this-agents-id" class="md-nav__link">
    Get this agent's ID
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retrieve-an-agents-posts" class="md-nav__link">
    Retrieve an agent's posts
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="simple-micro-blog-tutorial">Simple Micro Blog tutorial<a class="headerlink" href="#simple-micro-blog-tutorial" title="Permanent link">&para;</a></h1>
<p>Welcome to the Simple Micro blog tutorial in the Core Concepts tutorial series. The aim of this tutorial is to show how entries can be linked to each other in a Holochain app. A link is simply a relationship between two entries. It's a useful way to find some data from something you already know. For example, you could link from your user's agent ID entry to their blog posts.</p>
<p>You will be building on the previous <a href="">Hello World</a> tutorial and making a super simple blog app. The app's users will be able to post a blog post and then retrieve other users' posts.</p>
<h2 id="dna-hash">DNA hash<a class="headerlink" href="#dna-hash" title="Permanent link">&para;</a></h2>
<p>The way you run your conductor has changed from <code>hc run</code> to calling <code>holochain</code> directly. As a consequence, the hash of your app's DNA now lives in the <code>conductor-config.toml</code> file. However, anytime you change your code and run <code>hc package</code> the hash will be different. So you will need to update the <code>conductor-config.toml</code> file.</p>
<p>Enter the nix-shell:</p>
<div class="codehilite"><pre><span></span>nix-shell https://holochain.love
</pre></div>


<p>Package your app:</p>
<div class="codehilite"><pre><span></span>hc package
</pre></div>


<p>Copy the DNA hash (example shown):</p>
<div class="codehilite"><pre><span></span>DNA hash: QmfKyAk2jXgESca2zju6QbkLqUM1xEjqDsmHRgRxoFp39q
</pre></div>


<p>Update the <code>conductor-config.toml</code> dna hash:</p>
<div class="codehilite"><pre><span></span><span class="k">[[dnas]]</span>
  <span class="n">id</span> <span class="o">=</span> <span class="s">&quot;hello&quot;</span>
  <span class="n">file</span> <span class="o">=</span> <span class="s">&quot;dist/hello_holo.dna.json&quot;</span>
  <span class="n">hash</span> <span class="o">=</span> <span class="s">&quot;&lt;new_dna_hash&gt;&quot;</span>
</pre></div>


<h2 id="post">Post<a class="headerlink" href="#post" title="Permanent link">&para;</a></h2>
<p>We will store our posts as a <code>Post</code> struct that holds a message of type <code>String</code>, a timestamp of type <code>u64</code>, and an author ID  of type <code>Address</code>.</p>
<p>We're done with the Hello World tutorial, so remove the <code>Person</code> struct and add the <code>Post</code> struct:</p>
<p><a href="https://asciinema.org/a/tpHdFyTkVnfK5fkVWkgYDjH4c"><img alt="asciicast" src="https://asciinema.org/a/tpHdFyTkVnfK5fkVWkgYDjH4c.svg" /></a></p>
<h2 id="entry">Entry<a class="headerlink" href="#entry" title="Permanent link">&para;</a></h2>
<p>Update the <code>person</code> entry type definition to <code>post</code>:</p>
<p><a href="https://asciinema.org/a/aYwqCZ2w2b4D3vAZw4F4unOfz"><img alt="asciicast" src="https://asciinema.org/a/aYwqCZ2w2b4D3vAZw4F4unOfz.svg" /></a></p>
<h2 id="agent-id">Agent ID<a class="headerlink" href="#agent-id" title="Permanent link">&para;</a></h2>
<p>Now you have a post entry but you also need some way to find the posts an agent makes. To do this you can create an agent 'anchor' entry which you will use to link to the posts that the user makes. An anchor is a simple string whose only purpose is to be an easy-to-find entry to attach links to.</p>
<p>Define an agent anchor entry type by adding the following lines below the <code>post_entry_def</code>.</p>
<p>Add an <code>agent_entry_def</code> function which creates an entry type for the agent:</p>
<div class="codehilite"><pre><span></span><span class="cp">#[entry_def]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">agent_entry_def</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">ValidatingEntryType</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</pre></div>


<p>Start the <code>entry!</code> macro for the agent entry:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="n">entry</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="n">name</span>: <span class="s">&quot;agent&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">description</span>: <span class="s">&quot;Hash of agent&quot;</span><span class="p">,</span><span class="w"></span>
</pre></div>


<p>Set sharing to public so other agents can find this agent's anchor (and hence their posts):</p>
<div class="codehilite"><pre><span></span><span class="w">        </span><span class="n">sharing</span>: <span class="nc">Sharing</span>::<span class="n">Public</span><span class="p">,</span><span class="w"></span>
</pre></div>


<p>Add basic validation to make sure this is the <code>Agent</code> type that is passed in:</p>
<div class="codehilite"><pre><span></span><span class="w">        </span><span class="n">validation_package</span>: <span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="n">hdk</span>::<span class="n">ValidationPackageDefinition</span>::<span class="n">Entry</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
<span class="w">        </span><span class="n">validation</span>: <span class="o">|</span><span class="w"> </span><span class="n">_validation_data</span>: <span class="nc">hdk</span>::<span class="n">EntryValidationData</span><span class="o">&lt;</span><span class="n">Agent</span><span class="o">&gt;|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<span class="w">        </span><span class="p">},</span><span class="w"></span>
</pre></div>


<p>Now you want to be able to link this agent entry to the post entry.</p>
<p>Start out with the <code>to!</code> link macro, which lets you create link definitions that link from this entry type to another entry type:</p>
<div class="codehilite"><pre><span></span><span class="w">        </span><span class="n">links</span>: <span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="n">to</span><span class="o">!</span><span class="p">(</span><span class="w"></span>
</pre></div>


<p>Define a link type from this entry to the <code>post</code> entry called <code>author_post</code>:</p>
<div class="codehilite"><pre><span></span><span class="w">               </span><span class="s">&quot;post&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">               </span><span class="n">link_type</span>: <span class="s">&quot;author_post&quot;</span><span class="p">,</span><span class="w"></span>
</pre></div>


<p>Add empty validation for this link:</p>
<div class="codehilite"><pre><span></span><span class="w">               </span><span class="n">validation_package</span>: <span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                   </span><span class="n">hdk</span>::<span class="n">ValidationPackageDefinition</span>::<span class="n">Entry</span><span class="w"></span>
<span class="w">               </span><span class="p">},</span><span class="w"></span>
<span class="w">               </span><span class="n">validation</span>: <span class="o">|</span><span class="n">_validation_data</span>: <span class="nc">hdk</span>::<span class="n">LinkValidationData</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                   </span><span class="nb">Ok</span><span class="p">(())</span><span class="w"></span>
<span class="w">               </span><span class="p">}</span><span class="w"></span>
<span class="w">            </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<h2 id="create-a-post">Create a post<a class="headerlink" href="#create-a-post" title="Permanent link">&para;</a></h2>
<p>Remove the <code>create_person</code> function.</p>
<p>You need a function for creating a new post. Think about the ingredients that might go into the <code>Post</code> structure: a message, a timestamp, and and the author's ID.</p>
<p>The message will come from the UI. For simplicity the timestamp will come from the UI as well. Time is a pretty tricky concept in the distributed world and requires careful planning. The author's ID will come from the special constant <code>hdk::AGENT_ADDRESS</code>, which you can access from your zome functions.</p>
<blockquote>
<h4 id="why-do-i-have-to-specify-a-timestamp-and-author-arent-they-already-in-the-entrys-header">Why do I have to specify a timestamp and author? Aren't they already in the entry's header?<a class="headerlink" href="#why-do-i-have-to-specify-a-timestamp-and-author-arent-they-already-in-the-entrys-header" title="Permanent link">&para;</a></h4>
<p>If two agents publish entries with identical type and content, they'll have the same hash on the DHT. That means that, for all purposes, <em>there's only one entry</em> with two authors. This is fine for some cases. But it causes problems in a microblog. When one author wants to delete an existing message, does the other author's copy get deleted too? Adding a timestamp and author ID makes the two posts distinct, with their own hashes.</p>
</blockquote>
<p>Add a public <code>create_post</code> function that takes a message as a <code>String</code> and a timestamp as a <code>u64</code>:</p>
<div class="codehilite"><pre><span></span><span class="cp">#[zome_fn(</span><span class="s">&quot;hc_public&quot;</span><span class="cp">)]</span><span class="w"></span>
<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">create_post</span><span class="p">(</span><span class="n">message</span>: <span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">timestamp</span>: <span class="kt">u64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">ZomeApiResult</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</pre></div>


<p>Create the <code>Post</code> using the message, timestamp and this agents address:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Post</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">message</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">timestamp</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">author_id</span>: <span class="nc">hdk</span>::<span class="n">AGENT_ADDRESS</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="p">};</span><span class="w"></span>
</pre></div>


<p>Create the <code>Agent</code> struct from the <code>AGENT_ADDRESS</code>, turn it into an <code>Entry</code> and commit it:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">agent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Agent</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">id</span>: <span class="nc">hdk</span>::<span class="n">AGENT_ADDRESS</span><span class="p">.</span><span class="n">clone</span><span class="p">().</span><span class="n">into</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Entry</span>::<span class="n">App</span><span class="p">(</span><span class="s">&quot;agent&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="n">agent_id</span><span class="p">.</span><span class="n">into</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">agent_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hdk</span>::<span class="n">commit_entry</span><span class="p">(</span><span class="o">&amp;</span><span class="n">entry</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>Commit the post entry:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Entry</span>::<span class="n">App</span><span class="p">(</span><span class="s">&quot;post&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="n">post</span><span class="p">.</span><span class="n">into</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hdk</span>::<span class="n">commit_entry</span><span class="p">(</span><span class="o">&amp;</span><span class="n">entry</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>Create an <code>author_post</code> link from the agent to the post:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="n">hdk</span>::<span class="n">link_entries</span><span class="p">(</span><span class="o">&amp;</span><span class="n">agent_address</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">address</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;author_post&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>Return everything is Ok with the new post's address:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<h2 id="retrieve-all-of-a-users-posts">Retrieve all of a user's posts<a class="headerlink" href="#retrieve-all-of-a-users-posts" title="Permanent link">&para;</a></h2>
<p>Add the <code>retrieve_posts</code> public function that takes an author address and returns a <a href="https://doc.rust-lang.org/std/vec/struct.Vec.html">vector</a> of posts:</p>
<div class="codehilite"><pre><span></span><span class="cp">#[zome_fn(</span><span class="s">&quot;hc_public&quot;</span><span class="cp">)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">retrieve_posts</span><span class="p">(</span><span class="n">author_address</span>: <span class="nc">Address</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">ZomeApiResult</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Post</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</pre></div>


<p>Create an <code>Agent</code> struct from the passed address, turn it into an <code>Entry</code>, and calculate its address:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">agent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Agent</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">id</span>: <span class="nc">author_address</span><span class="p">.</span><span class="n">into</span><span class="p">()</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Entry</span>::<span class="n">App</span><span class="p">(</span><span class="s">&quot;agent&quot;</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w"> </span><span class="n">agent_id</span><span class="p">.</span><span class="n">into</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">agent_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hdk</span>::<span class="n">entry_address</span><span class="p">(</span><span class="o">&amp;</span><span class="n">entry</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>Get all the <code>author_post</code> links from the agent's address and load them as the <code>Post</code> type:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="n">hdk</span>::<span class="n">utils</span>::<span class="n">get_links_and_load_type</span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">address</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">LinkMatch</span>::<span class="n">Exactly</span><span class="p">(</span><span class="s">&quot;author_post&quot;</span><span class="p">),</span><span class="w"></span>
<span class="w">        </span><span class="n">LinkMatch</span>::<span class="n">Any</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<p>(Note that because you've already told Rust that this function is going to return a vector of posts, the compiler will tell <code>get_links_and_load_type</code> what type to use in the conversion.)</p>
<p>We're using a new directive, <code>link::LinkMatch</code>. You'll need to add it to your <code>use</code> statements at the top of the file:</p>
<div class="codehilite"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">hdk</span>::<span class="n">holochain_core_types</span>::<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">entry</span>::<span class="n">Entry</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">dna</span>::<span class="n">entry_types</span>::<span class="n">Sharing</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">link</span>::<span class="n">LinkMatch</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>


<h2 id="get-the-agents-id">Get the agent's ID<a class="headerlink" href="#get-the-agents-id" title="Permanent link">&para;</a></h2>
<p>As a user, you will need some way of getting your own agent's ID in the UI later so that you can pass it to others. Then they can try getting your posts.</p>
<p>Add a public <code>get_agent_id</code> function that returns an <code>Address</code>:</p>
<div class="codehilite"><pre><span></span><span class="cp">#[zome_fn(</span><span class="s">&quot;hc_public&quot;</span><span class="cp">)]</span><span class="w"></span>
<span class="k">fn</span> <span class="nf">get_agent_id</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">ZomeApiResult</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</pre></div>


<p>For this app you can use the agent's address as their ID, because that's what we're storing in the agent anchor entries:</p>
<div class="codehilite"><pre><span></span><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">hdk</span>::<span class="n">AGENT_ADDRESS</span><span class="p">.</span><span class="n">clone</span><span class="p">())</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>


<h2 id="show-the-agents-id-in-the-ui">Show the agent's ID in the UI<a class="headerlink" href="#show-the-agents-id-in-the-ui" title="Permanent link">&para;</a></h2>
<p>Let's start on the UI. Go to your GUI folder and open up the <code>index.html</code> file.</p>
<p>To make it easy to pass around agent ID, you can display the ID for the instance that each GUI is currently targeting. This should happen when the page loads and when the instance ID changes.</p>
<p>Add an <code>onload</code> event to the body that will call the <code>get_agent_id</code> function when the page loads:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">body</span> <span class="na">onload</span><span class="o">=</span><span class="s">&quot;get_agent_id()&quot;</span><span class="p">&gt;</span>
</pre></div>


<p>Add an <code>onfocusout</code> event to the instance text box that will call the same function when unfocused:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;instance&quot;</span> <span class="na">onfocusout</span><span class="o">=</span><span class="s">&quot;get_agent_id()&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;Enter your instance ID&quot;</span><span class="p">&gt;</span>
</pre></div>


<p>Now open up the <code>hello.js</code> file and add the <code>get_agent_id</code> function:</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">get_agent_id</span><span class="p">()</span> <span class="p">{</span>
</pre></div>


<p>Get the instance value and set up a zome call connection:</p>
<div class="codehilite"><pre><span></span>  <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;instance&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
  <span class="nx">holochainclient</span><span class="p">.</span><span class="nx">connect</span><span class="p">({</span> <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;ws://localhost:3401&quot;</span><span class="p">}).</span><span class="nx">then</span><span class="p">(({</span><span class="nx">callZome</span><span class="p">,</span> <span class="nx">close</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</pre></div>


<p>Call the <code>get_agent_id</code> zome function and then update the <code>agent_id</code> element with the result:</p>
<div class="codehilite"><pre><span></span>    <span class="nx">callZome</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;get_agent_id&#39;</span><span class="p">)({}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">update_element</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="s1">&#39;agent_id&#39;</span><span class="p">))</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></div>


<h2 id="update-the-ui-to-allow-posts-to-be-created">Update the UI to allow posts to be created<a class="headerlink" href="#update-the-ui-to-allow-posts-to-be-created" title="Permanent link">&para;</a></h2>
<p>Back in <code>index.html</code> turn the "create person" HTML into a post entry widget. Use a <code>textarea</code>, call the <code>create_post</code> function, and update all the labels and IDs:</p>
<p><a href="https://asciinema.org/a/mAPERkw51QbQQp2KZkTxZnwDB"><img alt="asciicast" src="https://asciinema.org/a/mAPERkw51QbQQp2KZkTxZnwDB.svg" /></a></p>
<h2 id="update-the-ui-to-retrieve-an-agents-posts">Update the UI to retrieve an agent's posts<a class="headerlink" href="#update-the-ui-to-retrieve-an-agents-posts" title="Permanent link">&para;</a></h2>
<p>Update the "retrieve person" HTML to retrieve posts:</p>
<p><a href="https://asciinema.org/a/0eQ1giTdu4BEOnQghXax1ALBE"><img alt="asciicast" src="https://asciinema.org/a/0eQ1giTdu4BEOnQghXax1ALBE.svg" /></a></p>
<h2 id="call-create_post-from-javascript">Call <code>create_post</code> from JavaScript<a class="headerlink" href="#call-create_post-from-javascript" title="Permanent link">&para;</a></h2>
<p>In the <code>hello.js</code> file add the <code>create_post</code> function that your HTML calls:</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">create_post</span><span class="p">()</span> <span class="p">{</span>
</pre></div>


<p>Get the post message and instance ID:</p>
<div class="codehilite"><pre><span></span>  <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;instance&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
</pre></div>


<p>Get the current timestamp:</p>
<div class="codehilite"><pre><span></span>  <span class="kd">var</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</pre></div>


<p>Make a zome call to <code>create_post</code> with the message and timestamp:</p>
<div class="codehilite"><pre><span></span>  <span class="nx">holochainclient</span><span class="p">.</span><span class="nx">connect</span><span class="p">({</span> <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;ws://localhost:3401&quot;</span><span class="p">}).</span><span class="nx">then</span><span class="p">(({</span><span class="nx">callZome</span><span class="p">,</span> <span class="nx">close</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">callZome</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;create_post&#39;</span><span class="p">)({</span><span class="nx">message</span><span class="o">:</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">timestamp</span><span class="o">:</span> <span class="nx">timestamp</span> <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">update_element</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="s1">&#39;post_address&#39;</span><span class="p">))</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></div>


<h2 id="update-the-posts-list-dynamically">Update the posts list dynamically<a class="headerlink" href="#update-the-posts-list-dynamically" title="Permanent link">&para;</a></h2>
<p>Add an empty list below the <code>post_agent_id</code> text box:</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;posts_output&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</pre></div>


<p>In the <code>hello.js</code> file add the following lines to update the <code>posts_output</code> dynamically.</p>
<p>Add the <code>display_posts</code> function:</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">display_posts</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
</pre></div>


<p>Get the <code>posts_output</code> HTML element:</p>
<div class="codehilite"><pre><span></span>  <span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;posts_output&#39;</span><span class="p">);</span>
</pre></div>


<p>Wipe the current contents of the list, if any:</p>
<div class="codehilite"><pre><span></span>  <span class="nx">list</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</pre></div>


<p>Parse the zome function's result as JSON:</p>
<div class="codehilite"><pre><span></span>  <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</pre></div>


<p>Sort the posts by their timestamps:</p>
<div class="codehilite"><pre><span></span>  <span class="kd">var</span> <span class="nx">posts</span> <span class="o">=</span> <span class="nx">output</span><span class="p">.</span><span class="nx">Ok</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">-</span> <span class="nx">b</span><span class="p">.</span><span class="nx">timestamp</span><span class="p">);</span>
</pre></div>


<p>For each post add a <code>&lt;li&gt;</code> element that contains the post's message:</p>
<div class="codehilite"><pre><span></span>  <span class="k">for</span> <span class="p">(</span><span class="nx">post</span> <span class="k">of</span> <span class="nx">posts</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;LI&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">textnode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">textnode</span><span class="p">);</span>
    <span class="nx">list</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h2 id="get-this-agents-id">Get this agent's ID<a class="headerlink" href="#get-this-agents-id" title="Permanent link">&para;</a></h2>
<p>Add the <code>get_agent_id</code> function:</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">get_agent_id</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;instance&#39;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
</pre></div>


<p>Call the <code>get_agent_id</code> function and update the <code>agent_id</code> element:</p>
<div class="codehilite"><pre><span></span>  <span class="nx">holochainclient</span><span class="p">.</span><span class="nx">connect</span><span class="p">({</span> <span class="nx">url</span><span class="o">:</span> <span class="s2">&quot;ws://localhost:3401&quot;</span><span class="p">}).</span><span class="nx">then</span><span class="p">(({</span><span class="nx">callZome</span><span class="p">,</span> <span class="nx">close</span><span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">callZome</span><span class="p">(</span><span class="nx">instance</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;get_agent_id&#39;</span><span class="p">)({}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">update_element</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="s1">&#39;agent_id&#39;</span><span class="p">))</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></div>


<h2 id="retrieve-an-agents-posts">Retrieve an agent's posts<a class="headerlink" href="#retrieve-an-agents-posts" title="Permanent link">&para;</a></h2>
<p>This is very similar to <code>retrieve_person</code>, so just update that function:</p>
<p><a href="https://asciinema.org/a/oiFGzlKexjVVMrNxf7Gc00Oiw"><img alt="asciicast" src="https://asciinema.org/a/oiFGzlKexjVVMrNxf7Gc00Oiw.svg" /></a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../hello_world/" title="Hello World" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Hello World
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c648116f.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>